KISSY.add("gallery/kcharts/1.1/linechart/index",function(g,p,q,s,o,w,v,x,y,l,z,A){var h=g.all,n=g.Event,m="ks-chart-default",r,p=function(a){this._cfg=a;this.init()};g.extend(p,o,{init:function(){o.prototype.init.call(this,this._cfg);this.chartType="linechart";if(this._$ctnNode[0]){var a={themeCls:m,autoRender:!0,comparable:!1,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},
isShow:!0},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:"{COLOR}"},hoverAttr:{stroke:"#fff",r:5,fill:"{COLOR}","stroke-width":0}},xLabels:{isShow:!0,css:{color:"#666","font-size":"12px"}},yLabels:{isShow:!0,css:{color:"#666","font-size":"12px"}},xAxis:{isShow:!0,css:{zIndex:10}},yAxis:{isShow:!0,css:{zIndex:10},num:5},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!0,css:{}},line:{isShow:!0,attr:{"stroke-width":"3px"},hoverAttr:{"stroke-width":"4px"}},pointLines:{isShow:!1,
css:{}},legend:{isShow:!1},tip:{isShow:!0,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:!0}};this._lines={};this._finished=[];m=this._cfg.themeCls||a.themeCls;this._cfg=g.mix(g.mix(a,y[m],l,l,!0),this._cfg,l,l,!0);this.color=r=new w({themeCls:m});0<this._cfg.colors.length&&r.removeAllColors();for(var b in this._cfg.colors)r.setColor(this._cfg.colors[b]);this._cfg.autoRender&&this.render(!0)}},drawTitle:function(){var a=this.htmlPaper,b=m+"-title",c=this._cfg,d=0.6*this._innerContainer.y;
c.title.isShow&&""!=c.title.content&&(this._title=a.rect(0,0,this._$ctnNode.width(),d).addClass(b).css(g.mix({"line-height":d+"px"},c.title.css)).html(c.title.content))},drawSubTitle:function(){var a=this.htmlPaper,b=m+"-subtitle",c=this._cfg,d=this._innerContainer,e=0.4*d.y;c.subTitle.isShow&&""!=c.subTitle.content&&(this._subTitle=a.rect(0,0.6*d.y,this._$ctnNode.width(),e).addClass(b).css(g.mix({"line-height":e+"px"},c.subTitle.css)).html(c.subTitle.content))},getRealPointsNum:function(a){var b=
0,c;for(c in a)a[c].x&&a[c].y&&b++;return b},getVisableLineNum:function(){for(var a=this._cfg,b=a.series.length,c=b,d=0;d<b;d++)!1==a.series[d].isShow&&c--;return c},drawLine:function(a,b,c){if(a&&a.length){var d=this.getLinePath(a),e=this.paper,a=this.color.getColor(b).DEFAULT,d=e.path(d).attr(g.mix(this._cfg.line.attr,{stroke:a})),e=this.getVisableLineNum();this._stocks[b].stocks=this.drawStocks(this._points[b],this.processAttr(this._cfg.points.attr,a));this._finished.push(!0);this._finished.length==
e&&c&&c();return d}},animateLine:function(a,b,c){var d=this,e=d._cfg,f=d.paper,k=d.getLinePath(a),i=s.getTotalLength(k),j=d.getRealPointsNum(a),B=e.anim?e.anim.duration||500:500,h=d.get("area-width"),l=[],n,m=0,o,p,q,t=g.mix({stroke:r.getColor(b).DEFAULT},e.line.attr),u=f.path(n).attr(t);l[0]=d.drawStock(a[0].x,a[0].y,d.processAttr(e.points.attr,t.stroke));p=d.getVisableLineNum();(new A({duration:B,easing:"easeNone",onstep:function(b,c){o=c*i;n=s.getSubpath(k,0,o);q=s.pathBBox(n);m=Math.floor(q.width/
h);!l[m]&&a[m]&&(l[m]=d.drawStock(a[m].x,a[m].y,d.processAttr(e.points.attr,t.stroke)));u&&u.attr({path:n})},onend:function(){1<j&&!l[j-1]&&a[j-1]&&(l[j-1]=d.drawStock(a[j-1].x,a[j-1].y,d.processAttr(e.points.attr,t.stroke)));d._stocks[b].stocks=l;d._finished.push(!0);d._finished.length==p&&c&&c();g.log("动画结束")}})).run();return u},getLinePath:function(a){for(var b="",c=this.getRealPointsNum(a),d=0;!a||!a[d]||!a[d].x||!a[d].y;)if(d<c)d++;else break;if(d>=c)throw Error("数据格式有误，请检查defineKey的值");b+="M"+
a[d].x+","+a[d].y;if("arc"==this._cfg.lineType&&2<c){b+=" R";d+=1;for(c=a.length;d<c;d++)a[d].x&&a[d].y&&(b+=a[d].x+","+a[d].y+" ")}else{d+=1;for(c=a.length;d<c;d++)a[d].x&&a[d].y&&(b+=" L"+a[d].x+","+a[d].y)}return b},drawLines:function(a){var b=this._cfg;this._lines={};this._stocks={};for(var c in this._points){var d=this.getLinePath(this._points[c]),e=r.getColor(c),f=this.processAttr(this._cfg.points.attr,e.DEFAULT),k=this.processAttr(this._cfg.points.hoverAttr,e.HOVER);this._stocks[c]={points:this._points[c],
color:e,attr:f,hoverAttr:k};f=b.anim?!1==b.series[c].isShow?l:this.animateLine(this._points[c],c,a):!1==b.series[c].isShow?l:this.drawLine(this._points[c],c,a);this._lines[c]={line:f,path:d,points:this._points[c],color:e,attr:g.mix({stroke:e.DEFAULT},this._cfg.line.attr)}}return this._lines},processAttr:function(a,b){var c=g.clone(a),d;for(d in c)c[d]&&"string"==typeof c[d]&&(c[d]=c[d].replace("{COLOR}",b));return c},drawStocks:function(a,b){var c=[],d;for(d in a)a[d].x&&a[d].y?c.push(this.drawStock(a[d].x,
a[d].y,b)):c.push("");return c},drawStock:function(a,b,c){var d=this.paper,e=this._cfg.points.attr;return a&&b?d.circle(a,b,e.r,c).attr(e).attr(c):l},drawGridsX:function(){var a=this._points[0],b=[];if(1<a.length){var c=(a[1].x-a[0].x)/2;b.push({x:a[0].x-c});for(var d in a)b.push({x:a[d].x- -c})}a=0;for(c=b.length;a<c;a++)this._gridsX.push(this.drawGridX(b[a]));return this._gridsX},drawGridX:function(a){var b=this._cfg.themeCls+"-gridsx";return this.htmlPaper.lineY(a.x,this._innerContainer.tl.y,this._innerContainer.height).addClass(b).css(this._cfg.xGrids.css)},
drawGridY:function(a,b){var c=this._innerContainer.width,b=b||this._cfg.yGrids.css,d=this._cfg.themeCls+"-gridsy";return this.htmlPaper.lineX(a.x,a.y,c).addClass(d).css(b)},drawGridsY:function(){for(var a=this._innerContainer.tl.x,b=this._pointsY,c=0,d=b.length;c<d;c++)this._gridsY[c]={"0":this.drawGridY({x:a,y:b[c].y}),num:this.coordNum[c]}},drawAreas:function(){var a=this._innerContainer,b=a.tl.y,c=this._points[0],a=Math.round(c&&c[0]&&c[1]&&c[1].x-c[0].x||a.width),d=Math.round(this._innerContainer.height),
e=this.htmlPaper,f=this._cfg.themeCls+"-areas",k=this._cfg.areas.css;this.set("area-width",a);for(var i=0,j=c.length;i<j;i++)this._areas.push(e.rect(c[i].x-a/2,b,a,d).addClass(f).css(k))},drawAxisX:function(){var a=this._innerContainer,b=a.bl,c=this._cfg.themeCls+"-axisx";return this._axisX=this.htmlPaper.lineX(b.x,b.y,a.width).addClass(c).css(this._cfg.xAxis.css||{})},drawAxisY:function(){var a=this._innerContainer,b=a.tl,c=this._cfg.themeCls+"-axisy";return this._axisY=this.htmlPaper.lineY(b.x,
b.y,a.height).addClass(c).css(this._cfg.yAxis.css||{})},drawLabelsX:function(){var a=this._cfg.xAxis.text,b;for(b in a)this._labelX[b]=this.drawLabelX(b,a[b])},drawLabelsY:function(){for(var a in this._pointsY)this._labelY[a]={"0":this.drawLabelY(a,this._pointsY[a].number),num:this._pointsY[a].number};return this._labelY},drawLabelX:function(a,b){var c=this.htmlPaper,d=this._pointsX,e=this._cfg.themeCls+"-xlabels",f;f="";if(a<(d.length||0))return f=this._cfg.xLabels.template||"{{data}}",f=g.isFunction(f)?
f(a,b):q(f).render({data:b}),d=d[a],d[0]=c.text(d.x,d.y,"<span class="+e+">"+f+"</span>","center").children().css(this._cfg.xLabels.css),d[0]},drawLabelY:function(a,b){var c=this.htmlPaper,d=this._cfg.themeCls+"-ylabels",e;e="";e=this._cfg.yLabels.template||"{{data}}";return(e=g.isFunction(e)?e(a,b):q(e).render({data:b}))&&c.text(this._pointsY[a].x,this._pointsY[a].y,"<span class="+d+">"+e+"</span>","right","middle").children().css(this._cfg.yLabels.css)},drawPointLines:function(){var a=this.htmlPaper,
b=this._cfg.themeCls+"-pointlines",c=this._innerContainer;this._pointlines=[];for(var d in this._pointsX)this._pointlines.push(a.lineY(this._pointsX[d].x,c.tl.y,c.height).addClass(b).css(this._cfg.pointLines.css).css({display:"none"}));return this._pointlines},renderTip:function(){var a=this._cfg,b=this._innerContainer,a=g.mix(a.tip,{rootNode:this._$ctnNode,clsName:a.themeCls,boundry:a.tip.boundryDetect?{x:b.tl.x,y:b.tl.y,width:b.width,height:b.height}:{}},l,l,!0);return this.tip=new z(a)},renderEvtLayout:function(){var a=
this._innerContainer,b=this._points[0],c=b&&b[0]&&b[1]&&b[1].x-b[0].x||a.width,d=a.height,e=this._multiple,f=this._evtEls._areas=[],k=this._evtEls._rects=[],i;i=this._evtEls.paper?this._evtEls.paper:this._evtEls.paper=new v(this._$ctnNode,{clsName:"ks-chart-evtlayout",prependTo:!1,width:a.width,height:d,left:a.tl.x,top:a.tl.y,css:{"z-index":20,background:"#fff",filter:"alpha(opacity =1)","-moz-opacity":0.01,"-khtml-opacity":0.01,opacity:0.01}});for(var j=0,k=b.length;j<k;j++)f[j]=i.rect(b[j].x-c/
2,a.tl.y,c,d).addClass("ks-chart-evtlayout-areas");if(e)for(j in this._stocks)if(a=this._stocks[j],k=[],b=a.points,a.stocks){for(var g in b)k[g]=i.rect(b[g].x-c/2,b[g].y-5,c,10).attr({line_index:j,index:g}).addClass("ks-chart-evtlayout-rects");this._evtEls._rects[j]=k}},clearEvtLayout:function(){if(this._evtEls._areas)for(var a in this._evtEls._areas)this._evtEls._areas[a].remove();if(this._evtEls._rects)for(a in this._evtEls._rects)for(var b in this._evtEls._rects[a])this._evtEls._rects[a][b].remove()},
renderLegend:function(){var a=this._cfg.legend,b=a.container&&h(a.container)[0]?h(a.container):this._$ctnNode;return this.legend=new x({container:b,evtBind:!0,chart:this,iconType:"circle",css:a.css||{}})},render:function(a){var b=this,c=b._cfg,d=c.themeCls;a&&b._$ctnNode.html("");b.paper=s(b._$ctnNode[0],c.width,c.height);b.htmlPaper=new v(b._$ctnNode,{clsName:d});b.drawTitle();b.drawSubTitle();c.tip.isShow&&b.renderTip();c.areas.isShow&&b.drawAreas();c.xGrids.isShow&&b.drawGridsX();c.yGrids.isShow&&
b.drawGridsY();b._cfg.comparable&&b.drawPointLines();c.xAxis.isShow&&b.drawAxisX();c.yAxis.isShow&&b.drawAxisY();c.xLabels.isShow&&b.drawLabelsX();c.yLabels.isShow&&b.drawLabelsY();c.legend.isShow&&b.renderLegend();b.drawLines(function(){b.renderEvtLayout();b.bindEvt();g.log("finish");b.afterRender()});g.log(b)},bindEvt:function(){var a=this,b=a._evtEls,c=a._cfg.themeCls+"-areas-hover",d=function(){for(var b in a._stocks)if(a._stocks[b].stocks)return b}(),e=a._points[d],f=a._stocks[d];n.detach(h(".ks-chart-evtlayout-rects",
h(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter");d&&n.on(h(".ks-chart-evtlayout-rects",h(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter",function(b){var c=h(b.currentTarget),b=c.attr("index"),c=c.attr("line_index");d!=c&&(d=c,a.lineChangeTo(d));n.fire(h(".ks-chart-evtlayout-areas",h(".ks-chart-evtlayout",a._$ctnNode))[b],"mouseenter")});n.detach(h(".ks-chart-evtlayout-areas",h(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter");d&&n.on(h(".ks-chart-evtlayout-areas",h(".ks-chart-evtlayout",a._$ctnNode)),
"mouseenter",function(){var b=g.indexOf(this,h(".ks-chart-evtlayout-areas",h(".ks-chart-evtlayout",a._$ctnNode)));f=a._stocks[d];for(var i in a._stocks)for(var j in a._stocks[i].stocks)a._stocks[i].stocks[j]&&a._stocks[i].stocks[j].attr&&a._stocks[i].stocks[j].attr(a._stocks[i].attr);if(e&&e[b]&&e[b].y){if(a._pointlines){for(i in a._pointlines)a._pointlines[i].hide();a._pointlines[b].show()}if(a._cfg.comparable)for(i in a._stocks)a._stocks[i].stocks&&a._stocks[i].stocks[b]&&a._stocks[i].stocks[b].attr&&
a._stocks[i].stocks[b].attr(a._stocks[i].hoverAttr);else f.stocks[b]&&f.stocks[b].attr&&f.stocks[b].attr(f.hoverAttr);a._areas[b].addClass(c).siblings().removeClass(c);a._points[d][b].dataInfo&&(a.stockChange(d,b),a._cfg.tip.isShow&&a.tipHandler(d,b))}a.areaChange(b)});n.detach(b.paper.$paper,"mouseleave");d&&n.on(b.paper.$paper,"mouseleave",function(){a._lines[d].line.attr(a._lines[d].attr);a.tip&&a.tip.hide();for(var b in a._pointlines)a._pointlines[b].hide();for(b in a._areas)a._areas[b].removeClass(a._cfg.themeCls+
"-areas-hover");for(b in a._stocks)for(var c in a._stocks[b].stocks)a._stocks[b].stocks[c]&&a._stocks[b].stocks[c].attr&&a._stocks[b].stocks[c].attr(a._stocks[b].attr);a.paperLeave()})},lineChangeTo:function(a){var b=this._cfg,c;for(c in this._stocks)this._stocks[c].points=this._points[c];for(c in this._lines)c!=a&&this._lines[c].line&&this._lines[c].line.attr(this._lines[c].attr);this._lines[a].line.remove();for(c in this._stocks[a].stocks)this._stocks[a].stocks[c].remove&&this._stocks[a].stocks[c].remove();
this._lines[a].line=this.drawLine(this._points[a],a).attr(b.line.hoverAttr);for(c in this._stocks)for(var d in this._stocks[c].stocks)this._stocks[c].stocks[d]&&this._stocks[c].stocks[d].attr&&this._stocks[c].stocks[d].attr(b.points.attr)},hideLine:function(a){o.prototype.removeData.call(this,a);this.animateGridsAndLabels();this._lines[a].line.remove();for(var b in this._stocks){if(a==b){for(var c in this._stocks[a].stocks)this._stocks[a].stocks[c]&&this._stocks[a].stocks[c].remove();delete this._stocks[a].stocks}this._stocks[b].points=
this._points[b]}for(b in this._lines)if(b!=a){var d=this.getLinePath(this._points[b]);if(this._lines[b].path!=d&&""!=d)for(c in this._lines[b].line&&this._lines[b].line.stop()&&this._lines[b].line.animate({path:d},500),this._lines[b].path=d,this._stocks[b].stocks)this._stocks[b].stocks[c]&&this._stocks[b].stocks[c].stop().animate({cx:this._stocks[b].points[c].x,cy:this._stocks[b].points[c].y},500)}this.clearEvtLayout();this.renderEvtLayout();this.bindEvt();g.log(this)},showLine:function(a){this._cfg.series[a].isShow=
!0;o.prototype.recoveryData.call(this,a);this.animateGridsAndLabels();this._lines[a].line=this.drawLine(this._points[a],a);for(var b in this._stocks)this._stocks[b].points=this._points[b];for(b in this._lines)if(a=this.getLinePath(this._points[b]),this._lines[b].path!=a&&this._lines[b].line){this._lines[b].line&&this._lines[b].line.stop().animate({path:a},500);this._lines[b].path=a;for(var c in this._stocks[b].stocks)this._stocks[b].stocks[c]&&this._stocks[b].stocks[c].stop().animate({cx:this._stocks[b].points[c].x,
cy:this._stocks[b].points[c].y},500)}this.clearEvtLayout();this.renderEvtLayout();this.bindEvt()},animateGridsAndLabels:function(){Math.max(this._pointsY.length,this._gridsY.length);for(var a in this._labelY)this._labelY[a]&&this._labelY[a][0]&&this._labelY[a][0].remove(),this._gridsY[a]&&this._gridsY[a][0]&&this._gridsY[a][0].remove();this.drawGridsY();this.drawLabelsY()},tipHandler:function(a,b){var c=this._lines[a].color.DEFAULT,d=this.tip,e=this._cfg,f=e.series,k=e.tip.template;d.getInstance();
var i=this._points[a][b];if(k){if(this._cfg.comparable){var k={datas:{}},j=[],h;for(h in this._points)if(this._stocks[h].stocks){this._points[h][b].dataInfo.color=this._stocks[h].color.DEFAULT;var l=g.merge(this._points[h][b].dataInfo,f[h]);delete l.data;k.datas[h]=l}for(h in k.datas)j.push(k.datas[h]);k.datas=o.prototype.arraySort(j,!0,"y");f=k}else f=g.merge(this._points[a][b].dataInfo,f[a]),delete f.data;d.fire("setcontent",{data:f});d.fire("move",{x:i.x,y:i.y,style:this.processAttr(e.tip.css,
c)})}},areaChange:function(){this.fire("areaChange",this)},paperLeave:function(){this.fire("paperLeave",this)},stockChange:function(a,b){var c=this._stocks[a];this.fire("stockChange",g.mix({target:c.stocks[b],currentTarget:c.stocks[b],lineIndex:Math.round(a),stockIndex:Math.round(b)},c.points[b]))},afterRender:function(){this.fire("afterRender",this)},getPaper:function(){return this.htmlPaper},clear:function(){this._$ctnNode.html("")}});return p},{requires:"base,gallery/template/1.0/index,gallery/kcharts/1.1/raphael/index,gallery/kcharts/1.1/basechart/index,gallery/kcharts/1.1/tools/color/index,gallery/kcharts/1.1/tools/htmlpaper/index,gallery/kcharts/1.1/legend/index,gallery/kcharts/1.1/linechart/theme,gallery/kcharts/1.1/tools/touch/index,gallery/kcharts/1.1/tip/index,gallery/kcharts/1.1/ft/index".split(",")});
KISSY.add("gallery/kcharts/1.1/linechart/theme",function(){return{"ks-chart-default":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:"{COLOR}"},hoverAttr:{stroke:"#fff",r:5,fill:"{COLOR}","stroke-width":0}},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},
xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},pointLines:{css:{color:"#ccc"}},tip:{css:{border:"2px solid {COLOR}"}}},"ks-chart-analytiks":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",color:"#666"},isShow:!0},points:{attr:{stroke:"{COLOR}",fill:"#fff",r:4,"stroke-width":2},hoverAttr:{stroke:"{COLOR}",
fill:"#fff",r:5,"stroke-width":2}},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},pointLines:{css:{color:"#ccc"}},tip:{css:{background:"{COLOR}"}}},"ks-chart-rainbow":{title:{content:"",css:{"text-align":"center","font-size":"16px","font-weight":"bold",color:"#666"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px",
color:"#666"},isShow:!0},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,fill:"{COLOR}"},hoverAttr:{stroke:"#fff",r:5,fill:"{COLOR}","stroke-width":0}},xGrids:{css:{color:"#eee"}},yGrids:{css:{color:"#eee"}},yAxis:{css:{color:"#ccc"}},xAxis:{css:{color:"#ccc"}},xLabels:{css:{color:"#666","font-size":"12px"}},yLabels:{css:{color:"#666","font-size":"12px"}},pointLines:{css:{color:"#ccc"}},tip:{css:{background:"{COLOR}"}}}}});
